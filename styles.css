:root {
    /* @tweakable [primary accent color used for buttons, highlights, and active states] */
    --color-primary: #3b82f6; /* refined crisp blue (tweakable) */
    /* @tweakable Primary accent darker shade for hover states */
    --color-primary-dark: #2563eb;
    /* @tweakable Subtle accent used for links and lighter emphasis */
    --color-primary-light: #60a5fa;

    /* @tweakable [primary accent color used for sketch highlights] */ --color-primary: #3b82f6;
    /* @tweakable [secondary accent (yellow) for highlights] */ --color-accent-yellow: #f5c400;
    /* @tweakable [background / paper color for sketch effect] */ --color-paper: #ffffff;
    /* @tweakable [ink color for strokes] */ --color-ink: #000000;
    /* @tweakable [muted ink for lighter text] */ --color-ink-muted: #6b6b6b;

    --color-text-dark: var(--color-ink); /* Very light text for contrast on dark bg */
    --color-text-medium: var(--color-ink-muted);
    --color-text-muted: #9AA6B2;

    --color-bg-light: #ffffff; /* Near-black IDE background */
    --color-bg-medium: #f7f7f7; /* Panels and secondary backgrounds */
    --color-bg-dark: #efefef; /* Slightly lighter for headers/inputs */

    --color-border: rgba(0,0,0,0.12); /* Subtle borders */
    
    --color-success-bg: #10B981; /* Green-500 */
    --color-success-text: #ffffff; /* Green-50 */
    --color-error-bg: #EF4444; /* Red-700 */
    --color-error-text: #ffffff; /* Red-50 */
    --color-warn-text: #F59E0B; /* Yellow-500 for warnings */
    --color-info-text: #60A5FA; /* Blue-500 for info */
    --color-debug-text: #9C27B0; /* Purple-500 for debug */

    --spacing-xs: 4px;
    --spacing-sm: 8px;
    --spacing-md: 12px;
    --spacing-lg: 16px;
    --spacing-xl: 24px;
    --spacing-2xl: 32px;

    /* All corners are now square */
    --border-radius: 0; /* square edges everywhere */
    
    --shadow-sm: 0 6px 18px rgba(0,0,0,0.12); /* stronger, crisp shadow */
    --shadow-md: 0 14px 30px rgba(0,0,0,0.16);
    --sidebar-width: 340px; /* increased width for Project Files panel */
    --file-tree-bg: #f1f3f5; /* slightly darker, cooler paper for file area */
    --file-tree-font-size: 13px; /* more compact font for file tree */
    --file-tree-padding: 8px; /* tighter padding for a denser tree */
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', sans-serif; /* Simplified font stack */
    background: var(--color-bg-light);
    color: var(--color-text-dark);
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

/* Scrollbar styles for WebKit browsers (Chrome, Safari, Edge) */
::-webkit-scrollbar {
    width: 10px; /* Vertical scrollbar width */
    height: 10px; /* Horizontal scrollbar height */
}

::-webkit-scrollbar-track {
    background: var(--color-bg-light); /* Background of the scrollbar track */
    border-radius: 0; /* Square corners */
}

::-webkit-scrollbar-thumb {
    background: var(--color-border); /* Color of the scrollbar thumb */
    border-radius: 0; /* Square corners */
    border: 1px solid var(--color-bg-medium); /* Small border to separate from track */
}

::-webkit-scrollbar-thumb:hover {
    background: var(--color-primary-dark); /* Color on hover */
}

/* Scrollbar styles for Firefox */
/* Applies to elements that explicitly set scrollbar-width, otherwise default browser style */
html, body, .sidebar, .chat-messages, .console-output, 
.project-list, .repo-list, .file-tree-container, 
.github-auth input, .modal-body, .chat-input textarea, 
.code-editor textarea, .custom-modal-body, .custom-prompt-input,
.image-preview-content, .video-preview-content, .deploy-section {
    scrollbar-width: thin; /* "auto" or "thin" */
    scrollbar-color: var(--color-border) var(--color-bg-light); /* thumb-color track-color */
}

.app-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    flex: 1;
}

.header {
    /* Stylized header with gradient matching new theme */
    background: linear-gradient(90deg, var(--color-bg-dark) 0%, var(--color-bg-medium) 100%);
    border-bottom: 1px solid var(--color-border);
    padding: var(--spacing-md) var(--spacing-xl);
    box-shadow: var(--shadow-sm);
    flex-shrink: 0;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-family: 'Inter', sans-serif; /* Changed logo font to Inter for consistency */
    font-size: 24px;
    font-weight: 700;
    color: var(--color-text-dark); /* Logo color changed to text-dark for consistency */
}

.header-actions {
    display: flex;
    gap: var(--spacing-md);
}

.btn {
    padding: var(--spacing-md) var(--spacing-lg);
    border: none;
    border-radius: 0; /* square */
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    transition: all 0.2s ease;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--color-border);
    background: var(--color-bg-light);
    color: var(--color-text-dark);
}

/* Primary button accent */
.btn-primary {
    background: var(--color-primary);
    color: #fff;
    border-color: color-mix(in srgb, var(--color-primary) 70%, black 30%);
    box-shadow: 0 6px 14px rgba(37,99,235,0.18);
}

.btn-primary:hover {
    background: color-mix(in srgb, var(--color-primary) 80%, black 20%);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.btn-secondary {
    background: var(--color-bg-dark);
    color: var(--color-text-dark);
    border: 1px solid var(--color-border);
}

.btn-secondary:hover {
    background: var(--color-bg-medium);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.btn-sm {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: 12px;
    gap: var(--spacing-xs);
}

.btn-icon {
    width: 32px;
    height: 32px;
    padding: 0;
    justify-content: center;
    align-items: center;
    border-radius: 0; /* Square corners */
}
.btn-icon svg {
    width: 14px;
    height: 14px;
}

.main-content {
    display: grid;
    /* New grid layout for sidebar | chat-panel | editor-panel */
    grid-template-columns: var(--sidebar-width) 1fr 1.2fr; /* Wider sidebar to better fit file tree */
    flex: 1;
    overflow: hidden;
}

.sidebar {
    width: var(--sidebar-width);
    min-width: var(--sidebar-width); /* Prevent the sidebar from shrinking below the intended width */
    max-width: var(--sidebar-width); /* Prevent the sidebar from expanding beyond the intended width */
    background: var(--file-tree-bg); /* distinct, compact shade for the project area */
    border-right: 1px solid var(--color-border);
    padding: calc(var(--spacing-lg)) var(--spacing-md); /* more compact vertical padding */
    overflow-y: auto;
    box-shadow: var(--shadow-sm);
    position: relative;
    z-index: 500;
    height: 100%; /* Ensure it fills its grid cell */
    display: flex;
    flex-direction: column;
    flex: 0 0 var(--sidebar-width); /* Force fixed width in layout and prevent flexible stretching */
}

.project-section, .github-section {
    margin-bottom: var(--spacing-2xl);
}

.project-files-section {
    display: flex; /* Make it a flex container */
    flex-wrap: wrap; /* Allow buttons to wrap */
    gap: var(--spacing-md); /* Space between buttons */
    align-items: center; /* Vertically align items */
    margin-bottom: var(--spacing-2xl);
}

.project-section h3, .github-section h3, .project-files-section h3 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: var(--spacing-lg);
    color: var(--color-text-dark);
    width: 100%; /* Make header take full width */
    flex-shrink: 0; /* Prevent header from shrinking when buttons wrap */
}

/* NEW: Puter.AI Cloud Storage Status */
.cloud-storage-status {
    padding: var(--spacing-md);
    border-radius: 0;
    margin-bottom: var(--spacing-lg);
    font-size: 14px;
    font-weight: 500;
    text-align: center;
    background: var(--color-bg-light); /* Dark background */
    color: var(--color-text-medium); /* Light text */
    border: 1px solid var(--color-border);
}

.cloud-storage-status.connected {
    background: var(--color-success-bg);
    color: var(--color-success-text);
    border-color: var(--color-success-bg);
}
.cloud-storage-status.disconnected {
    background: var(--color-error-bg);
    color: var(--color-error-text);
    border-color: var(--color-error-bg);
}

.project-list {
    margin-top: var(--spacing-md);
}

.project-item {
    padding: var(--spacing-md) var(--spacing-lg);
    border: 1px solid var(--color-border);
    border-radius: 0; /* Square corners */
    margin-bottom: var(--spacing-sm);
    cursor: pointer;
    transition: all 0.2s ease;
    background: var(--color-bg-light); /* Use new bg-medium */
    color: var(--color-text-medium);
    display: flex; /* Make it a flex container */
    justify-content: space-between; /* Space out content and actions */
    align-items: center; /* Vertically align items */
}

.project-item:hover {
    background: var(--color-bg-dark); /* Darker on hover */
    border-color: var(--color-bg-dark);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

.project-item.active {
    background: var(--color-primary);
    color: var(--color-bg-light); /* Dark text on active project item */
    border-color: var(--color-primary);
    box-shadow: var(--shadow-md);
}

/* Specific styling for active project/repo items' text */
.project-item.active .project-name,
.project-item.active .project-description,
.repo-item.active {
    color: var(--color-bg-light);
}

.project-info {
    flex-grow: 1; /* Allows the info to take up available space */
    margin-right: var(--spacing-sm); /* Space between info and actions */
    display: flex; /* Make project-info a flex container */
    flex-direction: column; /* Stack name and description vertically */
    justify-content: center; /* Center contents vertically within project-info itself */
    min-height: 28px; /* Ensure it's at least as tall as the buttons */
}

.project-name {
    font-weight: 500;
    margin: 0; /* Reset margins */
    padding: 0; /* Reset padding */
    line-height: 1.2; /* Tighter line height for more predictable sizing */
    color: inherit;
}

.project-description {
    font-size: 12px;
    margin: 0; /* Reset margins */
    padding: 0; /* Reset padding */
    margin-top: var(--spacing-xs); /* Added margin-top to separate from name */
    line-height: 1.2; /* Tighter line height for more predictable sizing */
    color: var(--color-text-light);
    color: inherit;
    opacity: 0.8;
}

.project-actions {
    display: flex;
    gap: var(--spacing-xs); /* Small gap between buttons */
    flex-shrink: 0; /* Prevent actions from shrinking */
    /* Ensure vertical alignment with the project info */
    align-items: center; 
}

.project-actions .btn-icon {
    width: 28px; /* Smaller size for action buttons */
    height: 28px;
    padding: 0; /* Override default button padding */
    background: none;
    border: 1px solid transparent;
    color: var(--color-text-light);
    transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
}

.project-actions .btn-icon:hover {
    background-color: var(--color-bg-dark);
    border-color: var(--color-border);
    color: var(--color-text-dark);
    transform: none; /* No lift effect for these small buttons */
    box-shadow: none;
}

.project-item.active .project-actions .btn-icon {
    color: var(--color-bg-light); /* Icons white on active project */
    border-color: transparent; /* No border for active */
}

.project-item.active .project-actions .btn-icon:hover {
    background-color: var(--color-primary-dark);
    color: var(--color-bg-light);
    border-color: var(--color-primary);
}

/* NEW: File actions container for rename/delete buttons */
.file-actions {
    display: flex;
    gap: var(--spacing-xs); /* Small gap between buttons */
    margin-left: auto; /* Push to the right */
    flex-shrink: 0;
    max-width: 36%; /* keep action area compact so file-name keeps visible space */
    justify-content: flex-end;
}
.file-actions .btn-icon {
    width: 24px; /* Slightly smaller for file actions */
    height: 24px;
    padding: 0;
}
.file-actions .btn-icon svg {
    width: 12px; /* Smaller icons */
    height: 12px;
}
.file-actions .btn-icon:hover {
    background-color: var(--color-bg-light); /* Darker hover for smaller buttons */
    color: var(--color-primary); /* Primary color on hover */
    border-color: var(--color-primary-dark);
}

/* NEW: Style for download button to match other file actions */
.download-file-btn {
    background: none;
    border: none;
    color: inherit;
    font-size: 14px;
    line-height: 1;
    cursor: pointer;
    padding: 0 4px;
    opacity: 0.7;
    transition: opacity 0.2s ease, color 0.2s ease;
}

.download-file-btn:hover {
    opacity: 1;
    color: var(--color-primary); /* Use primary color for download hover */
}

.github-status {
    padding: var(--spacing-md);
    border-radius: 0; /* Square corners */
    margin-bottom: var(--spacing-lg);
    font-size: 14px;
    font-weight: 500;
}

.github-connected {
    background: var(--color-success-bg);
    color: var(--color-success-text);
    border: 1px solid var(--color-success-bg); /* Use solid color for border */
}

.github-disconnected {
    background: var(--color-error-bg);
    color: var(--color-error-text);
    border: 1px solid var(--color-error-bg); /* Use solid color for border */
}

.repo-list {
    margin-top: var(--spacing-md);
}

.repo-item {
    padding: var(--spacing-md) var(--spacing-lg);
    border: 1px solid var(--color-border);
    border-radius: 0; /* Square corners */
    margin-bottom: var(--spacing-sm);
    cursor: pointer;
    transition: all 0.2s ease;
    background: var(--color-bg-light); /* Subtle background for repo items */
    color: var(--color-text-medium);
}

.repo-item:hover {
    background: var(--color-bg-dark); 
    border-color: var(--color-bg-dark);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

.repo-item.active {
    background: var(--color-primary);
    color: var(--color-bg-light);
    border-color: var(--color-primary);
    box-shadow: var(--shadow-md);
}

/* NEW: File Tree View */
.file-tree-container {
    margin-top: var(--spacing-md);
    border: 1px solid rgba(0,0,0,0.06);
    border-radius: 0;
    padding: var(--file-tree-padding);
    background-color: var(--file-tree-bg);
    font-size: var(--file-tree-font-size); /* compact text */
    line-height: 1.2;
    max-height: calc(100vh - 220px); /* allow taller tree while keeping header/footer visible */
    width: 100%; /* Ensure the tree fills the sidebar width exactly */
    box-sizing: border-box; /* Include padding in width calc so no horizontal gaps appear */
    overflow-x: hidden; /* Prevent horizontal scrollbar and keep visual column alignment */
}

.tree-category {
    margin-bottom: var(--spacing-xs);
    border-bottom: 1px solid rgba(0,0,0,0.03); /* subtle divider between categories */
    padding-bottom: 6px;
    width: 100%; /* ensure category uses full container width */
    box-sizing: border-box;
}

.tree-category-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: 8px 10px; /* tightened */
    font-weight: 600;
    color: var(--color-text-dark);
    cursor: pointer;
    border-radius: 0; /* Square corners */
    transition: background-color 0.2s ease;
    background: transparent; /* remove noisy gradient for clarity */
    border-left: 4px solid transparent;
    font-size: 13px;
}

.tree-category-header:hover {
    background-color: var(--color-bg-dark);
}

.tree-category.expanded .tree-category-header {
    border-left-color: var(--color-primary);
}

.tree-toggle-icon {
    display: flex;
    align-items: center;
    color: var(--color-text-light);
}

.tree-category .tree-toggle-icon svg {
    transform: rotate(-90deg);
    transition: transform 0.2s ease;
}

.folder-icon {
    display: flex;
    align-items: center;
    color: var(--color-primary); /* Folder icon color */
}

.tree-category-children {
    padding-left: 12px; /* reduced indent so deep hierarchies fit horizontally */
    border-left: 1px solid rgba(0,0,0,0.04);
    margin-left: 6px;
    width: calc(100% - 6px); /* keep children within sidebar width */
    box-sizing: border-box;
}

.tree-file-item {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 8px; /* compact row spacing */
    font-size: 12px; /* slightly smaller for density */
    color: var(--color-text-medium);
    cursor: pointer;
    border-radius: 0; /* Square corners */
    transition: background-color 0.2s ease, color 0.2s ease;
    margin-bottom: 2px;
    position: relative;
    width: 100%; /* Ensure each file row spans full sidebar width */
    box-sizing: border-box;
    overflow: visible; /* allow dropdown menus to escape row clipping so the 3-dot menu is visible */
}

.tree-file-item:hover {
    background-color: var(--color-bg-dark);
    color: var(--color-text-dark);
}

.tree-file-item.active {
    background-color: var(--color-primary);
    color: var(--color-bg-light);
}
.tree-file-item.active .file-icon svg {
    color: var(--color-bg-light); /* Ensure icons are white when active */
}

.file-icon {
    width: 18px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-right: 6px;
}

.file-name {
    flex-grow: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 12.5px; /* match compactness */
}

.delete-file-btn {
    background: none;
    border: none;
    color: inherit; /* Inherit color from parent (.tree-file-item) */
    font-size: 14px;
    line-height: 1;
    cursor: pointer;
    padding: 0 4px;
    margin-left: auto; /* Push to the right */
    opacity: 0.7;
    transition: opacity 0.2s ease, color 0.2s ease;
}

.delete-file-btn:hover {
    opacity: 1;
    color: var(--color-error-text); /* Red on hover */
}

/* File "more" button and dropdown menu for file actions */
.file-more-btn {
    background: transparent;
    border: none;
    font-size: 18px;
    line-height: 1;
    width: 30px;
    height: 30px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--color-text-light);
    border-radius: 4px;
    transition: background 0.12s ease, color 0.12s ease, opacity 0.12s ease;
    opacity: 0; /* keep visually hidden until hover, but remain focusable */
    pointer-events: auto; /* allow keyboard focus and explicit clicks */
    outline: none;
}

/* ensure the three-dots button is consistently visible on hover and focus for accessibility */
.tree-file-item:focus-within .file-more-btn,
.tree-file-item:hover .file-more-btn,
.tree-file-item.more-open .file-more-btn {
    opacity: 1;
    pointer-events: auto;
}

/* Keep the more-menu visible when the mouse is over it (so it doesn't disappear while interacting) */
.more-menu {
    position: fixed; /* use fixed so it isn't clipped by sidebar's scrolling/overflow */
    right: auto; /* allow JS to control left/top; avoid conflicting right anchor */
    top: 36px;
    background: var(--color-bg-light);
    border: 1px solid var(--color-border);
    box-shadow: var(--shadow-md);
    min-width: 160px;
    z-index: 10050; /* ensure dropdown floats above everything (modals remain higher) */
    pointer-events: auto;
    display: none;
    flex-direction: column;
    padding: 6px 0;
    border-radius: 4px;
}

.more-menu .more-menu-item {
    padding: 8px 12px;
    font-size: 13px;
    color: var(--color-text-dark);
    cursor: pointer;
    display: flex;
    gap: 8px;
    align-items: center;
}
.more-menu .more-menu-item:hover {
    background: var(--color-bg-dark);
    color: var(--color-primary);
}

.chat-panel {
    display: flex;
    flex-direction: column;
    background: var(--color-bg-medium);
    border-right: 1px solid var(--color-border); /* Separator between chat and editor */
    overflow: hidden;
    height: 100%; /* Fill the grid cell */
}

.chat-section {
    flex: 1; /* Make chat section fill its parent */
    display: flex;
    flex-direction: column;
    background: var(--color-bg-medium); /* Chat section background */
    /* Removed border-bottom as chat-panel provides border-right */
    overflow: hidden;
}

.chat-header {
    padding: var(--spacing-lg) var(--spacing-xl);
    border-bottom: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    background-color: var(--color-bg-dark); /* Ensure header is white */
}

.chat-header h3 {
    font-size: 16px;
    font-weight: 600;
    color: var(--color-text-dark);
}

.project-title {
    font-size: 14px;
    color: var(--color-text-light);
    font-weight: 500;
    margin-left: var(--spacing-md); /* Add some space */
    flex-grow: 1; /* Allow title to grow */
}

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: var(--spacing-lg) var(--spacing-xl);
    background: var(--color-bg-medium);
}

.message {
    margin-bottom: var(--spacing-md);
    animation: fadeIn 0.3s ease;
    display: flex; /* Use flexbox for avatar and content alignment */
}

.message.user {
    justify-content: flex-end; /* Align user messages to the right */
}

.message.assistant {
    justify-content: flex-start; /* Align assistant messages to the left */
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.message-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: var(--spacing-sm);
    flex-shrink: 0;
    align-self: flex-end; /* Align avatar to the bottom of the message bubble */
    border: 2px solid var(--color-primary); /* Add primary color border */
}

.message.user .message-avatar {
    order: 2; /* Put user avatar on the right */
    margin-left: var(--spacing-sm);
    margin-right: 0;
}

.message-content-wrapper { /* New wrapper for content + header */
    display: flex;
    flex-direction: column;
    max-width: 70%; /* Max width of message content within its wrapper */
}

.message.user .message-content-wrapper {
    align-items: flex-end; /* Align user message header/content to the right */
}
.message.assistant .message-content-wrapper {
    align-items: flex-start; /* Align assistant message header/content to the left */
}

.message-header-info { /* New element for name and timestamp */
    display: flex;
    gap: var(--spacing-sm);
    font-size: 12px;
    color: var(--color-text-light);
    margin-bottom: var(--spacing-xs);
    align-items: center;
}

.message.user .message-header-info {
    flex-direction: row-reverse; /* Reverse order for user's name/timestamp */
}

.message-header-info .name {
    font-weight: 600;
    color: var(--color-text-dark);
}

.message-content {
    display: inline-flex; /* Changed from inline-block to inline-flex for flexbox behavior */
    flex-direction: column; /* NEW: Stack children vertically */
    max-width: 100%; /* Max width of message content within its wrapper */
    padding: var(--spacing-md) var(--spacing-lg);
    border-radius: 0; /* Square corners */
    font-size: 14px;
    line-height: 1.5;
    word-wrap: break-word;
    box-shadow: var(--shadow-sm);
    gap: var(--spacing-sm); /* Gap between paragraph and actions */
    background: var(--color-bg-dark); /* Darker background for message bubbles */
    color: var(--color-text-dark); /* Ensure text is visible */
}

.message.user .message-content {
    background: var(--color-primary-dark); /* Primary color for user messages */
    color: #ffffff;
}

/* Markdown specific styles */
.message-content p {
    margin: 0; /* Reset default paragraph margin */
    flex-grow: 1; /* Allow paragraph to take available space */
}

.message-content h1,
.message-content h2,
.message-content h3,
.message-content h4,
.message-content h5,
.message-content h6 {
    color: var(--color-primary-light);
    margin-top: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
    line-height: 1.2;
}

.message-content ul,
.message-content ol {
    margin-left: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
}

.message-content li {
    margin-bottom: var(--spacing-xs);
}

.message-content a {
    color: var(--color-primary-light);
    text-decoration: underline;
}

.message-content strong,
.message-content b {
    color: var(--color-text-dark);
}

.message-content em,
.message-content i {
    font-style: italic;
    color: var(--color-text-medium);
}

/* Code block / pre styling updated to resemble IDE (VS Code like) */
.message-content pre {
    background-color: #0b1220; /* deep editor background for code blocks */
    color: #cbd5e1;
    padding: 12px 14px;
    border-radius: 6px;
    border: 1px solid rgba(255,255,255,0.04);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.02), var(--shadow-sm);
    overflow: auto;
    font-family: 'Source Code Pro', 'SFMono-Regular', 'Consolas', 'Monaco', 'Liberation Mono', monospace;
    font-size: 13px;
    line-height: 1.6;
}

/* Slight adjustments for inline code */
.message-content code:not(pre code) {
    background-color: rgba(255,255,255,0.03);
    color: #7DD3FC; /* soft cyan-blue inline code */
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Source Code Pro', monospace;
    font-size: 0.92em;
}

/* Syntax-like token colors for copyable code blocks (visual only) */
.message-content pre .token.keyword { color: #c792ea; }    /* purple */
.message-content pre .token.string  { color: #ecc48d; }    /* warm yellow */
.message-content pre .token.function{ color: #82aaff; }    /* blue */
.message-content pre .token.comment { color: #5c7086; }    /* comment grey */

.message.user .message-content {
    background: var(--color-primary-dark); /* Primary color for user messages */
    color: #ffffff;
}

.message.assistant .message-content {
    background: var(--color-bg-dark); /* Darker background for message bubbles */
    color: var(--color-text-dark); /* Ensure text is visible */
}

.message-content pre code {
    display: block;
    font-family: 'Source Code Pro', monospace;
    font-size: 13px;
    line-height: 1.4;
    color: var(--color-text-dark);
}

/* Copy code button */
.copy-code-btn {
    position: absolute;
    top: var(--spacing-xs);
    right: var(--spacing-xs);
    background-color: var(--color-bg-medium);
    color: var(--color-text-light);
    border: 1px solid var(--color-border);
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
    border-radius: 0;
    transition: all 0.2s ease;
    z-index: 1; /* Ensure it's above code */
}

.copy-code-btn:hover {
    background-color: var(--color-primary-dark);
    color: var(--color-bg-light);
    border-color: var(--color-primary);
}

/* NEW: Styles for images embedded directly in chat messages */
.message-content img.message-image {
    max-width: 100%;
    height: auto;
    border-radius: 0; /* Square corners */
    margin-top: var(--spacing-sm); /* Space above the image */
    margin-bottom: var(--spacing-sm); /* Space below the image */
    display: block; /* Ensures it takes full width and new line */
}

/* NEW: Styles for videos embedded directly in chat messages */
.message-content video.message-video {
    max-width: 100%;
    height: auto;
    border-radius: 0; /* Square corners */
    margin-top: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
    display: block;
    background-color: black; /* Ensure black background for video player */
}

/* NEW: Styles for the "View Full / Save Image" and "View Full / Save Video" buttons in chat messages */
.view-image-button, .view-video-button {
    align-self: flex-start; /* Aligns button to the left within the message bubble */
    margin-top: var(--spacing-sm); /* Space above the button */
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: 12px;
    background-color: var(--color-bg-light); /* Darker background */
    color: var(--color-text-dark); /* Light text */
    border: 1px solid var(--color-border);
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
}

.view-image-button:hover, .view-video-button:hover {
    background-color: var(--color-bg-dark);
    color: var(--color-primary);
    border-color: var(--color-primary-dark);
    transform: none; /* No lift for smaller buttons */
    box-shadow: none;
}

/* NEW: Container for speaker icon and other actions at the bottom of the message */
.message-actions { 
    display: flex;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-sm); /* Space below the text content */
    align-self: flex-end; /* Default for assistant message (aligns actions to the right within its bubble) */
}

/* Override message-actions alignment for user messages (aligns actions to the left within its bubble) */
.message.user .message-actions {
    align-self: flex-start; 
}

/* Common styles for the speaker icon and new more actions button */
.speaker-icon, .more-actions-btn { 
    background: none;
    border: none;
    color: var(--color-text-light); /* Default color for icons */
    cursor: pointer;
    padding: var(--spacing-xs);
    border-radius: 0; /* Square corners */
    transition: background-color 0.2s ease, color 0.2s ease;
    flex-shrink: 0;
    width: 28px;
    height: 28px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.speaker-icon svg, .more-actions-btn svg {
    width: 16px;
    height: 16px;
}

.speaker-icon:hover, .more-actions-btn:hover {
    background-color: var(--color-bg-light); /* Lighter background on hover */
    color: var(--color-text-dark); /* Darker color on hover */
}

/* Specific hover for speaker icon to match primary color when speaking or active */
.speaker-icon:hover {
    background-color: var(--color-primary-light);
    color: var(--color-bg-light);
}

.chat-input {
    display: flex;
    padding: var(--spacing-lg) var(--spacing-xl);
    gap: var(--spacing-md);
    border-top: 1px solid var(--color-border);
    flex-shrink: 0;
    background-color: var(--color-bg-dark);
    margin-top: 6px; /* ensure chat input doesn't sit flush to bottom by small gap */
}

.chat-input textarea {
    flex: 1;
    padding: var(--spacing-md) var(--spacing-lg);
    border: 1px solid var(--color-border);
    border-radius: 0; /* Square corners */
    resize: none;
    font-family: inherit;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
    min-height: 40px;
    /* Adjusted max-height for larger chat window */
    max-height: 200px;
    overflow-y: auto;
    background-color: var(--color-bg-light); /* Darker input background */
    color: var(--color-text-dark);
}

.chat-input textarea:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(255, 179, 0, 0.25); /* Updated shadow color to new primary */
}

/* NEW: Editor Panel container styles */
.editor-panel {
    display: flex;
    flex-direction: column;
    background: var(--color-bg-medium);
    overflow: hidden;
    height: 100%; /* Fill the grid cell */
}

/* Editor/Console Panel - now directly inside .editor-panel */
.editor-console-panel {
    flex: 1; /* Make it fill its parent .editor-panel */
    display: flex;
    flex-direction: column;
    background: var(--color-bg-medium);
    /* Removed border-top as not needed in new layout */
    overflow: hidden;
}

.panel-header-tabs {
    display: flex;
    border-bottom: 1px solid var(--color-border);
    background-color: var(--color-bg-dark); /* Slightly off-white */
    flex-shrink: 0;
}

.panel-tab {
    padding: var(--spacing-md) var(--spacing-lg);
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: var(--color-text-light);
    border-right: 1px solid var(--color-border);
    transition: all 0.2s ease;
}

.panel-tab:hover:not(.active) {
    background-color: var(--color-bg-medium);
    color: var(--color-text-dark);
}

.panel-tab.active {
    color: var(--color-primary);
    background-color: var(--color-bg-medium);
    border-bottom: 2px solid var(--color-primary);
}

.panel-content {
    flex: 1;
    display: none; /* Hidden by default */
    flex-direction: column;
    overflow: hidden;
}

.panel-content.active {
    display: flex; /* Shown when active */
}

.code-header {
    padding: var(--spacing-md) var(--spacing-xl);
    border-bottom: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between; /* Space out file tabs and code actions */
    align-items: center;
    flex-shrink: 0;
    background-color: var(--color-bg-dark); /* Slightly off-white */
}

/* Make code-actions compact and right-aligned */
.code-actions {
    display: flex;
    gap: 8px; /* compact spacing */
    align-items: center;
    justify-content: flex-end;
}

/* Ensure preview/sync buttons are small and compact in the header */
.code-actions .btn {
    padding: 6px 10px;
    font-size: 13px;
}

/* Slight layout tweak so the file-info doesn't overflow the header */
.file-info {
    flex: 1 1 auto;
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 0; /* allow shrinking when window is narrow */
}

.current-file-name-display {
    max-width: 360px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Editor code textarea style improved for IDE feel */
.code-editor {
    flex: 1;
    position: relative;
    overflow: hidden;
}

.code-editor textarea {
    width: 100%;
    height: 100%;
    padding: 24px 28px; /* slightly larger padding for editor feel */
    border: none;
    outline: none;
    font-family: 'Space Mono', 'Source Code Pro', monospace;
    font-size: 15px; /* slightly larger for readability */
    line-height: 1.6;
    background: #0b1220; /* deep code editor surface */
    color: #e6eef6;
    resize: none;
    tab-size: 4;
    -moz-tab-size: 4;
    border-radius: 0;
    box-shadow: 0 10px 24px rgba(2,6,23,0.6);
    caret-color: #9AE6FF; /* brighter caret for visibility */
    white-space: pre; /* preserve whitespace */
    word-break: normal;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    transition: box-shadow 0.12s ease, border-color 0.12s ease;
}

/* subtle focus treatment for a more IDE-like feel */
.code-editor textarea:focus {
    box-shadow: 0 14px 32px rgba(2,6,23,0.7), 0 0 0 3px rgba(59,130,246,0.06);
    outline: none;
}

/* Console styling */
.console-output {
    flex: 1;
    background: #071422;
    border: 1px solid rgba(255,255,255,0.03);
    color: var(--color-text-dark);
    font-family: 'Source Code Pro', monospace;
    font-size: 13px;
    padding: var(--spacing-xl);
    overflow-y: auto;
    white-space: pre-wrap; /* Preserve whitespace and wrap text */
    word-break: break-word; /* Break long words */
}

.console-line {
    padding: 2px 0;
    border-bottom: 1px dotted rgba(255, 255, 255, 0.1); /* Lighter dotted line */
    display: block; /* Ensure each line takes full width */
}

.console-line:last-child {
    border-bottom: none;
}

.console-line.log {
    color: var(--color-text-dark); /* Default text color */
}

.console-line.info {
    color: var(--color-info-text);
}

.console-line.warn {
    color: var(--color-warn-text);
}

.console-line.error {
    color: var(--color-error-text);
    font-weight: bold;
}

.console-line.debug {
    color: var(--color-debug-text);
}

/* NEW: Comments Panel Styles */
.comments-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--color-bg-medium);
    overflow: hidden;
    padding: var(--spacing-lg) var(--spacing-xl);
}

.comment-list {
    flex: 1;
    overflow-y: auto;
    padding-bottom: var(--spacing-lg); /* Space above input area */
}

.comment-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: var(--spacing-md);
    padding: var(--spacing-sm);
    background-color: var(--color-bg-dark);
    border-radius: 0;
    border: 1px solid var(--color-border);
}

.comment-author-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: var(--spacing-sm);
    flex-shrink: 0;
    border: 2px solid var(--color-primary-light);
}

.comment-content-wrapper {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}

.comment-header {
    display: flex;
    align-items: center;
    margin-bottom: var(--spacing-xs);
    font-size: 13px;
    color: var(--color-text-light);
}

.comment-author-name {
    font-weight: 600;
    color: var(--color-text-dark);
    margin-right: var(--spacing-sm);
}

.comment-timestamp {
    font-size: 11px;
}

.comment-body {
    font-size: 14px;
    line-height: 1.5;
    color: var(--color-text-dark);
    word-wrap: break-word;
}

/* Markdown rendering within comments */
.comment-body p:last-child {
    margin-bottom: 0;
}

.comment-body img {
    max-width: 100%;
    /* Max-height and max-width are now controlled by JS using values from app.js tweakables */
    height: auto;
    object-fit: contain;
    border-radius: 0;
    margin-top: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
    display: block;
    border: 1px solid var(--color-border);
}

.comment-input-area {
    display: flex;
    padding-top: var(--spacing-md);
    border-top: 1px solid var(--color-border);
    background-color: var(--color-bg-dark); /* Match chat input background */
    flex-shrink: 0;
    gap: var(--spacing-md);
}

#commentInput {
    flex: 1;
    padding: var(--spacing-md) var(--spacing-lg);
    border: 1px solid var(--color-border);
    border-radius: 0;
    background-color: var(--color-bg-light);
    color: var(--color-text-dark);
    resize: vertical;
    min-height: 60px;
    max-height: 150px;
    font-family: inherit;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

#commentInput:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(255, 179, 0, 0.25);
}

#postCommentBtn {
    flex-shrink: 0;
    padding: var(--spacing-md) var(--spacing-lg);
}

.preview-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    animation: fadeInModal 0.2s ease-out;
}

@keyframes fadeInModal {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Base style for preview content (default initial size) */
.preview-content {
    background: var(--color-bg-medium);
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-lg);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
    transition: width 0.3s ease, height 0.3s ease, max-width 0.3s ease, max-height 0.3s ease, padding 0.3s ease; /* Add padding to transition */
    animation: slideInModal 0.3s ease-out;

    /* Desktop mode default */
    width: 90vw;
    height: 90vh;
    max-width: 90vw;
    max-height: 90vh;
    padding: var(--spacing-xl); /* Default padding for desktop */
}

@keyframes slideInModal {
    from { transform: translateY(20px) scale(0.95); opacity: 0; }
    to { transform: translateY(0) scale(1); opacity: 1; }
}

.preview-header {
    padding: var(--spacing-xl);
    border-bottom: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    background-color: var(--color-bg-dark);
}

.preview-header h3 {
    font-size: 18px;
    font-weight: 600;
    color: var(--color-text-dark);
}

/* NEW: Styles for the preview action buttons */
.preview-actions {
    display: flex;
    gap: var(--spacing-sm);
    margin-left: auto; /* Push actions to the right */
    margin-right: var(--spacing-md); /* Space before close button */
    flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
    align-items: center;
}

.preview-mode-buttons {
    display: flex;
    gap: var(--spacing-xs); /* Smaller gap within the mode buttons group */
    border: 1px solid var(--color-border); /* Group them with a border */
    border-radius: 0;
    padding: 2px;
    background-color: var(--color-bg-light);
}

.preview-mode-buttons .btn-sm {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: 12px;
    gap: var(--spacing-xs);
    border: none; /* No individual borders, grouped by parent */
    box-shadow: none; /* No individual shadows */
    background: transparent; /* Transparent background by default */
}

.preview-mode-buttons .btn-sm.active {
    background: var(--color-primary);
    color: var(--color-bg-light);
}

.preview-mode-buttons .btn-sm:hover:not(.active) {
    background: var(--color-bg-dark);
    color: var(--color-text-dark);
}

.preview-header button {
    background: none;
    border: none;
    font-size: 24px;
    color: var(--color-text-light);
    cursor: pointer;
    padding: var(--spacing-sm);
    line-height: 1;
    transition: color 0.2s ease;
}

.preview-header button:hover {
    color: var(--color-text-dark);
}

/* Ensure button styles are applied to new small buttons */
.preview-actions .btn-sm {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: 12px;
    gap: var(--spacing-xs);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-dark); /* Default text color for the buttons */
    background: var(--color-bg-light); /* Default background */
    border: 1px solid var(--color-border);
}

.preview-actions .btn-sm:hover {
    background: var(--color-bg-dark);
    color: var(--color-primary);
    border-color: var(--color-primary-dark);
    transform: none;
    box-shadow: none;
}

/* Specific mode styles for preview-content */
.preview-content.desktop-mode {
    width: 90vw;
    height: 90vh;
    max-width: 90vw;
    max-height: 90vh;
    padding: var(--spacing-xl);
}

.preview-content.tablet-mode {
    width: 768px; /* Target portrait tablet width */
    height: 1024px; /* Target portrait tablet height */
    max-width: min(90vw, 768px); /* Don't exceed 90vw or 768px */
    max-height: min(90vh, 1024px); /* Don't exceed 90vh or 1024px */
    padding: var(--spacing-md);
}

.preview-content.mobile-mode {
    width: 375px; /* Target typical mobile width */
    height: 667px; /* Target typical mobile height */
    max-width: min(90vw, 375px); /* Don't exceed 90vw or 375px */
    max-height: min(90vh, 667px); /* Don't exceed 90vh or 667px */
    padding: var(--spacing-sm);
}

/* When fullscreen, make the content fill the modal which is now fullscreen */
.preview-modal:fullscreen .preview-content {
    width: 100%;
    height: 100%;
    max-width: 100%; /* Override max-width/height when truly fullscreen */
    max-height: 100%;
    padding: var(--spacing-xl); /* Restore default padding in fullscreen */
}

#previewFrame {
    flex: 1;
    border: none;
    width: 100%;
    height: 100%; /* Important: iframe must fill its parent for sizing to work */
    background-color: var(--color-bg-light);
}

/* NEW: Preview loading overlay */
.preview-loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--color-bg-light); /* Dark background */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: var(--color-text-medium);
    font-size: 1.1em;
    z-index: 10; /* Above iframe, below close button */
    transition: opacity 0.3s ease;
}

.preview-loading-overlay.hidden {
    opacity: 0;
    pointer-events: none; /* Allow interaction with iframe once hidden */
}

.preview-loading-overlay .loading-spinner {
    margin-bottom: var(--spacing-md);
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.preview-loading-overlay .loading-text {
    font-weight: 500;
}

.github-modal, .options-modal, .custom-modal { /* Combined styles for all modals */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    animation: fadeInModal 0.2s ease-out;
}

.modal-content {
    background: var(--color-bg-medium);
    width: 500px;
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-lg);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    max-height: 90vh;
    max-width: 90vw;
    animation: slideInModal 0.3s ease-out;
}

.modal-header {
    padding: var(--spacing-xl);
    border-bottom: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    background-color: var(--color-bg-dark);
}

.modal-header h3 {
    font-size: 18px;
    font-weight: 600;
    color: var(--color-text-dark);
}

.modal-body {
    padding: var(--spacing-xl);
    overflow-y: auto;
    color: var(--color-text-dark); /* Ensure text is visible */
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-md);
    padding: var(--spacing-md) var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    background-color: var(--color-bg-dark);
}

.github-auth input, .custom-modal-body input {
    width: 100%;
    padding: var(--spacing-md) var(--spacing-lg);
    border: 1px solid var(--color-border);
    border-radius: 0; /* Square corners */
    margin: var(--spacing-lg) 0;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
    background-color: var(--color-bg-light);
    color: var(--color-text-dark);
}

.github-auth input:focus, .custom-modal-body input:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(255, 179, 0, 0.25);
}

/* NEW: Settings Item for Options Modal */
.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-md) 0;
    border-bottom: 1px solid var(--color-border);
    font-size: 15px;
    color: var(--color-text-dark);
}

.setting-item:last-child {
    border-bottom: none;
}

/* New button for manual org entry in GitHub modal */
#enterOrgManuallyBtn {
    width: 100%;
    text-align: center;
    justify-content: center; /* Center content horizontally */
}

.org-list {
    margin-top: var(--spacing-lg);
}

.org-item {
    padding: var(--spacing-md) var(--spacing-lg);
    border: 1px solid var(--color-border);
    border-radius: 0; /* Square corners */
    margin-bottom: var(--spacing-sm);
    cursor: pointer;
    transition: all 0.2s ease;
    background-color: var(--color-bg-light);
    color: var(--color-text-medium);
}

.org-item:hover {
    background: var(--color-bg-dark);
    border-color: var(--color-bg-dark);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

.org-item.selected {
    background: var(--color-primary);
    color: var(--color-bg-light);
    border-color: var(--color-primary);
    box-shadow: var(--shadow-md);
}

/* Speech Controls within the modal */
.speech-toggle {
    position: relative;
    display: inline-block;
    width: 38px;
    height: 22px;
    flex-shrink: 0; /* Prevent it from shrinking */
}

.speech-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
}

.speech-toggle .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--color-border);
    transition: .2s;
    border-radius: 0; /* Square corners */
}

.speech-toggle .slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 3px;
    bottom: 3px;
    background-color: var(--color-bg-light); /* Ensure consistency with white color */
    transition: .2s;
    border-radius: 0; /* Square corners */
}

.speech-toggle input:checked + .slider {
    background-color: var(--color-primary);
}

.speech-toggle input:checked + .slider:before {
    transform: translateX(16px);
}

.form-select {
    padding: var(--spacing-xs) var(--spacing-sm);
    border: 1px solid var(--color-border);
    border-radius: 0; /* Square corners */
    background-color: var(--color-bg-light);
    font-size: 13px;
    color: var(--color-text-medium);
    cursor: pointer;
    outline: none;
    appearance: none; /* Remove default arrow */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23757575' class='bi bi-chevron-down' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/></svg>");
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 16px;
    padding-right: 28px; /* Make space for the custom arrow */
}

.form-select:hover {
    border-color: var(--color-primary);
}

.loading {
    opacity: 0.6;
    pointer-events: none;
}

/* Context Menu */
.context-menu {
    position: absolute;
    background-color: var(--color-bg-medium);
    border: 1px solid var(--color-border);
    border-radius: 0; /* Square corners */
    box-shadow: var(--shadow-md);
    z-index: 1001; /* Above other content, below modals */
    min-width: 150px;
    padding: var(--spacing-sm) 0;
    display: none; /* Hidden by default */
    flex-direction: column;
}

.context-menu.active {
    display: flex;
}

.context-menu-item {
    padding: var(--spacing-sm) var(--spacing-md);
    cursor: pointer;
    font-size: 14px;
    color: var(--color-text-dark);
    transition: background-color 0.15s ease;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.context-menu-item:hover {
    background-color: var(--color-bg-dark);
}

.context-menu-item svg {
    width: 16px;
    height: 16px;
}

/* Image Preview Overlay */
.image-preview-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1002; /* Above context menu */
    animation: fadeInModal 0.2s ease-out;
}

.image-preview-content {
    background: var(--color-bg-medium);
    padding: var(--spacing-xl);
    border-radius: 0; /* Square corners */
    box-shadow: var(--shadow-lg);
    max-width: 80vw;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    position: relative;
    animation: slideInModal 0.3s ease-out;
}

.image-preview-content img {
    max-width: 100%;
    max-height: calc(80vh - 120px); /* Account for padding, close button and save button */
    height: auto;
    object-fit: contain;
    border-radius: 0; /* Square corners */
    margin-bottom: var(--spacing-md);
}

.image-preview-content button.close-btn {
    position: absolute;
    top: var(--spacing-md);
    right: var(--spacing-md);
    background: none;
    border: none;
    font-size: 24px;
    color: var(--color-text-light);
    cursor: pointer;
    padding: var(--spacing-sm);
    line-height: 1;
    transition: color 0.2s ease;
}

.image-preview-content button.close-btn:hover {
    color: var(--color-text-dark);
}

.image-preview-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 200px;
    min-height: 200px;
    color: var(--color-text-medium);
    font-size: 16px;
}

.image-preview-content .save-image-btn {
    align-self: center; /* Center the button within the flex column */
    margin-top: var(--spacing-md);
}

/* NEW: Video Preview Overlay (similar to image preview) */
.video-preview-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1002;
    animation: fadeInModal 0.2s ease-out;
}

.video-preview-content {
    background: var(--color-bg-medium);
    padding: var(--spacing-xl);
    border-radius: 0;
    box-shadow: var(--shadow-lg);
    max-width: 80vw;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    position: relative;
    animation: slideInModal 0.3s ease-out;
}

.video-preview-content video {
    max-width: 100%;
    max-height: calc(80vh - 120px); /* Account for padding, close button and save button */
    height: auto;
    object-fit: contain;
    border-radius: 0;
    margin-bottom: var(--spacing-md);
    background-color: black; /* Ensure black background for video player */
}

.video-preview-content button.close-btn {
    position: absolute;
    top: var(--spacing-md);
    right: var(--spacing-md);
    background: none;
    border: none;
    font-size: 24px;
    color: var(--color-text-light);
    cursor: pointer;
    padding: var(--spacing-sm);
    line-height: 1;
    transition: color 0.2s ease;
}

.video-preview-content button.close-btn:hover {
    color: var(--color-text-dark);
}

.video-preview-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 200px;
    min-height: 200px;
    color: var(--color-text-medium);
    font-size: 16px;
}

.video-preview-content .save-video-btn {
    align-self: center;
    margin-top: var(--spacing-md);
}

/* Styles for the new AI thinking animation */
.message.loading-message .message-content {
    align-items: flex-start; /* Align content to the left */
}

.ai-status-message {
    font-weight: 600;
    margin-bottom: var(--spacing-md);
    color: var(--color-text-dark); 
}

.loading-animation-container {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    padding-top: var(--spacing-sm);
    border-top: 1px dashed rgba(255, 255, 255, 0.1); /* Subtle separator */
}

.loading-phase-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 13px;
    color: var(--color-text-medium); /* Dimmed for inactive phases */
    opacity: 0.7;
    transition: opacity 0.3s ease, color 0.3s ease;
}

.loading-phase-item.active {
    color: var(--color-text-dark); /* Brighter for active phase */
    opacity: 1;
    font-weight: 500;
}

.loading-phase-item.completed {
    color: var(--color-success-text); /* Green for completed */
    opacity: 0.9;
    font-weight: 500;
}
.loading-phase-item.completed .loading-spinner svg {
    color: var(--color-success-bg); /* Checkmark icon color */
}

.loading-spinner {
    width: 16px;
    height: 16px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-shrink: 0;
}

/* Spinner dots animation */
.spinner-dots {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    font-family: monospace;
    font-size: 16px;
    line-height: 1;
    overflow: hidden;
    color: var(--color-primary); /* Gold color for spinner */
}

.spinner-dots span {
    opacity: 0;
    animation: fadeInOutDot 1.5s infinite;
}

.spinner-dots span:nth-child(1) { animation-delay: 0s; }
.spinner-dots span:nth-child(2) { animation-delay: 0.5s; }
.spinner-dots span:nth-child(3) { animation-delay: 1s; }

@keyframes fadeInOutDot {
    0%, 100% { opacity: 0; }
    33% { opacity: 1; }
    66% { opacity: 0; }
}

/* NEW: Deployment Section Styles */
.deploy-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--color-bg-medium);
    overflow-y: auto; /* Allow scrolling within the deployment info area */
    padding: var(--spacing-lg) var(--spacing-xl);
}

.deploy-info {
    font-size: 14px;
    line-height: 1.6;
    color: var(--color-text-medium);
    background-color: var(--color-bg-dark);
    padding: var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: 0;
}

.deploy-info p {
    margin-bottom: var(--spacing-sm);
}

.deploy-info strong {
    color: var(--color-text-dark);
}

.deploy-info p:last-child {
    margin-bottom: 0;
}

.deploy-info a {
    color: var(--color-primary);
    text-decoration: none;
}

.deploy-info a:hover {
    text-decoration: underline;
}

/* NEW: DevLog Panel Styles */
.devlog-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--color-bg-medium);
    overflow-y: auto;
    padding: var(--spacing-lg) var(--spacing-xl);
}

.devlog-section h4 {
    color: var(--color-text-dark);
    margin-bottom: var(--spacing-md);
    font-size: 18px;
}

/* NEW: DevLog Container Styles */
.devlog-container {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xl); /* Increased gap between scripts */
    padding: var(--spacing-md);
    background-color: var(--color-bg-dark); /* Slightly darker background for the container */
    border: 1px solid var(--color-border);
    border-radius: 0;
    max-height: calc(100vh - 200px); /* Adjust max-height to ensure it fits panel */
    overflow-y: auto;
}

.devlog-script {
    border: 1px solid var(--color-border);
    border-radius: 0;
    overflow: hidden;
}

.devlog-script h4 {
    background-color: var(--color-bg-light); /* Darker header for each script */
    color: var(--color-primary-light); /* Highlight script name with primary light color */
    padding: var(--spacing-sm) var(--spacing-md);
    margin: 0;
    font-size: 14px;
    font-weight: 600;
    border-bottom: 1px solid var(--color-border);
}

.devlog-code {
    background-color: var(--color-bg-medium);
    color: var(--color-text-dark);
    padding: var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: 0;
    font-family: 'Source Code Pro', monospace;
    font-size: 13px;
    line-height: 1.45;
    overflow-x: auto;
    white-space: pre; /* Preserve whitespace */
    margin: 0;
    max-height: 400px; /* Limit height of individual code blocks */
    overflow-y: auto;
}

/* Scrollbar styling for code blocks */
.devlog-code::-webkit-scrollbar {
    width: 8px;
}

.devlog-code::-webkit-scrollbar-track {
    background: var(--color-bg-medium); /* Track color for code blocks */
}

.devlog-code::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 0;
}

.devlog-code.error {
    color: var(--color-error-text);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .devlog-code {
        font-size: 12px;
        max-height: 300px;
    }
}

/* Toast/feedback polish */
.feedback-toast {
    background: rgba(20, 25, 30, 0.95);
    color: var(--color-text-dark);
    padding: 10px 14px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.04);
    box-shadow: var(--shadow-md);
    transition: opacity 0.2s ease, transform 0.12s ease;
}
.feedback-toast.show {
    opacity: 1;
    transform: translateY(0);
}

/* Sketch texture & utility (applies a subtle hand-drawn hatch border and inked shadows) */
.sketch {
    background-color: var(--color-paper);
    color: var(--color-text-dark);
    position: relative;
    transform: rotate(var(--sketch-tilt));
    transition: transform 0.12s ease;
    box-shadow: none;
}

/* Hand-drawn border using SVG stroke as border-image - subtle irregular line */
.sketch {
    border: 1px solid transparent;
    --_sketch-border: url('data:image/svg+xml;utf8,\
      <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8">\
        <path d="M1 1 L7 1" stroke="%230b0b0b" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" />\
      </svg>') 4 round;
    border-image: var(--_sketch-border);
}

/* Slight hatch background using repeating-linear-gradient for paper hatch */
.sketch.hatched {
    background-image:
      repeating-linear-gradient(135deg, rgba(0,0,0,0.02) 0 1px, transparent 1px 6px),
      repeating-linear-gradient(45deg, rgba(0,0,0,0.01) 0 1px, transparent 1px 10px);
    /* keep it subtle so code remains legible */
}

/* Sketchy button */
.btn.sketch {
    background: none;
    color: var(--color-ink);
    border: 0;
    padding: calc(var(--spacing-sm) + 2px) calc(var(--spacing-md) + 4px);
    outline: none;
    position: relative;
    cursor: pointer;
    font-weight: 700;
    box-shadow: none;
}
.btn.sketch::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    border: var(--sketch-stroke) dashed rgba(0,0,0,0.7);
    transform: translate(var(--sketch-offset-x), var(--sketch-offset-y));
    mix-blend-mode: multiply;
}

/* Accent variants */
.btn.sketch.primary {
    background: linear-gradient(90deg, rgba(37,99,235,0.06), rgba(37,99,235,0.02));
    color: var(--color-primary);
}
.btn.sketch.warning {
    background: linear-gradient(90deg, rgba(245,196,0,0.06), rgba(245,196,0,0.02));
    color: var(--color-accent-yellow);
}

/* Sketch panel (cards, modals, preview content) */
.sketch-panel {
    border-radius: 6px;
    padding: var(--spacing-md);
    background: var(--color-paper);
    box-shadow: none;
    border: 1px solid rgba(0,0,0,0.06);
}
.sketch-panel::before {
    content: '';
    position: absolute;
    pointer-events: none;
    top: 6px; left: 6px; right: 6px; bottom: 6px;
    border: 1px dashed rgba(0,0,0,0.04);
    transform: translate(var(--sketch-offset-x), var(--sketch-offset-y));
}

/* Sketch icons (wrap svg icons so strokes look hand-drawn) */
.icon-sketch svg {
    filter: drop-shadow(0 1px 0 rgba(0,0,0,0.04));
    stroke: var(--color-ink);
    stroke-width: 0.6;
    fill: none;
}

/* Text style to mimic hand-lettered titles (subtle) */
.hand-title {
    font-family: 'Space Mono', monospace;
    letter-spacing: 0.6px;
    text-shadow:
      0.4px 0.4px 0 rgba(0,0,0,0.03),
      -0.4px -0.4px 0 rgba(255,255,255,0.02);
    color: var(--color-ink);
    font-weight: 700;
}

/* Apply sketch to many core components */
.header, .sidebar, .chat-panel, .editor-panel, .preview-content, .modal-content, .image-preview-content, .video-preview-content {
    background: var(--color-paper);
    color: var(--color-text-dark);
    border: 1px solid var(--color-border);
    box-shadow: var(--shadow-md);
    border-radius: 0; /* square */
}

/* Slightly roughen code blocks borders to match sketch style */
.message-content pre, .devlog-code, .code-editor textarea {
    border: 1px dashed rgba(0,0,0,0.06);
    background: linear-gradient(180deg, #fbfbfb 0%, #f6f6f6 100%);
    box-shadow: none;
    color: var(--color-ink);
}

.tree-file-item .file-pin {
    font-size: 12px;
    margin-left: 6px;
    opacity: 0.95;
}

/* NEW: Reasonings Panel Styles */
.reasonings-panel {
    background: var(--color-bg-dark);
    border-top: 1px solid var(--color-border);
    padding: 8px 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    flex-shrink: 0;
    /* moved to near input so don't force large height */
}
.reasonings-panel.compact {
    font-size: 12px;
    line-height: 1.25;
    max-height: 140px;
    padding: 8px 10px;
    border-radius: 0;
}
.reasonings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
}
.reasonings-title {
    font-weight: 700;
    color: var(--color-primary);
    font-size: 13px;
    white-space: nowrap;
}
.reasonings-controls {
    display: flex;
    gap: 6px;
    align-items: center;
}
.reasonings-body {
    overflow: auto;
    max-height: 96px;
    padding-top: 4px;
    border-top: 1px dashed rgba(255,255,255,0.03);
}
.reasoning-steps {
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    color: var(--color-text-medium);
    white-space: pre-wrap;
    line-height: 1.3;
    margin: 4px 0;
    padding-right: 6px; /* avoid scrollbar overlap */
}

/* make thinking dots smaller for compact panel */
.reasonings-body .dot, #reasoningThinking .dot {
    display: inline-block;
    width: 6px;
    height: 6px;
    margin: 0 2px;
    border-radius: 50%;
    background: var(--color-primary);
    opacity: 0.25;
    animation: reasoningPulse 0.9s infinite;
}
#reasoningThinking .dot:nth-child(2) { animation-delay: 0.15s; }
#reasoningThinking .dot:nth-child(3) { animation-delay: 0.3s; }
@keyframes reasoningPulse { 0% { opacity: 0.25; transform: translateY(0);} 50% { opacity: 1; transform: translateY(-3px);} 100% { opacity: 0.25; transform: translateY(0);} }

/* collapsed state reduces to a single thin bar */
.reasonings-panel.collapsed { max-height: 36px; overflow: hidden; }
.reasonings-panel.collapsed .reasonings-body { display: none; }

/* improve readability of inner-thoughts: subtle italic and faded color for raw chain-of-thought */
.reasoning-steps .chain-thought {
    color: rgba(255,255,255,0.9);
    font-style: italic;
    font-size: 12px;
    line-height: 1.25;
}